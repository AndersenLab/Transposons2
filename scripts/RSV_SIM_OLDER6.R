#!/usr/bin/R
# this script generates a new genome using RSVSIM
# USE: RSV_SIM_OLDER6.R <genome_fasta_file> <transposons_to_insert>
# called on by run_RSVSim.sh

library("RSVSim")
#source("http://bioconductor.org/biocLite.R")
#biocLite("RSVSim")
#browseVignettes("RSVSim")


library(docopt)
#source("http://bioconductor.org/biocLite.R")
#biocLite("limma")
library(limma)


'usage: my_prog.R [-v -m <msg>] <RSVSIM_genome> <RSVSIM_te_pos>...

options:
-v        verbose
-m <msg>  Message' -> doc

opts <- docopt(doc)
RSVSIM_te_pos<-opts$RSVSIM_te_pos
RSVSIM_genome<-opts$RSVSIM_genome


directory = getwd()
setwd(directory)
#genome <- readDNAStringSet("WS245genome_and_tes2.fasta")# don't use just DNAStringSet..need "read"
genome <- readDNAStringSet(RSVSIM_genome)# don't use just DNAStringSet..need "read"
genome
names(genome)
print((names(genome))[sample(1:5,1)])
ins_position <-(names(genome))[sample(1:5,1)]

#??RSVSim
#?GRanges
#?simulateSV

#chromosome_file <- read.table("RSVSim_chromosomes.txt")
#chromosome_file <- as.data.frame(chromosome_file)
#chromosome_file
#summary(chromosome_file)
#str(chromosome_file)
#I<-chromosome_file[1,2]
#II<-chromosome_file[2,2]
#III<-chromosome_file[3,2]
#IV<-chromosome_file[4,2]
#V<-chromosome_file[5,2]
#X<-chromosome_file[6,2]


#above no longer working from command line, but works in Rstudio, using below instead:
I<-c(1:46012,46436:74440,74577:185098,188148:216923,217647:224017,228946:598760,601097:931690,932936:1534476,1535764:1800625,1800777:1860803,1860954:1933541,1933671:1980116,1980851:1998046,1999637:2050094,2054778:2055128,2059225:2130469,2131900:2198936,2199871:2908724,2909996:3087239,3087939:3088123,3088256:3133412,3134756:3491066,3492710:3848192,3851906:4098356,4099335:4607281,4607983:4752021,4753267:4814234,4816112:5467638,5468196:5555290,5557609:5979171,5982780:6144803,6145134:6228402,6229717:6350254,6352595:7641969,7642398:7842677,7846194:7980330,7981520:8073937,8074083:8372597,8373845:8464483,8465739:8541434,8543867:8546030,8546623:8619198,8622493:9003078,9003217:9082221,9082689:9300569,9301855:9452925,9453829:9497553,9500233:9637733,9638686:9656102,9656900:9679408,9682912:9776377,9777018:10239327,10241663:10263384,10263646:10303481,10318903:10459794,10461875:10499869,10500754:10528239,10529850:10620082,10620504:10910263,10911223:10950000,10959999:11028086,11029293:11084167,11084261:11115746,11115894:11142279,11143242:11170352,11172238:11305494,11305759:11338209,11339453:11426833,11427483:11637142,11638430:11849276,11851613:11943137,11944381:12401475,12402721:12481326,12482902:12891059,12891182:13085944,13100993:13147486,13148695:13162689,13164027:13212304,13213549:13455974,13458310:13487643,13488982:13522126,13523380:13595054,13597430:13740031,13742366:13875433,13875518:13929367,13936509:13977273,13978094:13989998,13992231:14021875,14023486:14248297,14250100:14290435,14295316:14315924,14316023:14479182,14479280:14529711,14529819:14574684,14574780:14637660,14637764:14637827,14638199:14729742,14730191:14753441,14753553:14981062,14983778:14998883,14998938:15050000)
II<-c(10000:16022,18357:425679,425860:478294,480629:507265,508093:526951,527252:665446,667031:784381,785993:802093,802848:894210,895821:996810,998885:1031685,1032931:1044191,1044343:1076025,1081644:1153121,1154454:1698101,1699285:1809094,1810756:1827276,1828886:1855618,1857797:1935480,1937092:1941946,1943106:1959107,1961569:2094620,2094797:2125626,2128686:2155910,2157592:2266810,2270555:2284258,2285318:2308399,2309566:2366128,2366473:2498120,2498893:2553770,2556450:2980282,2982620:3226538,3228875:3307692,3308952:3351104,3351274:3351579,3356987:3358400,3358552:3456156,3457379:3601657,3602903:3696202,3697452:3761761,3763005:3769111,3770721:3882420,3884812:3885520,3887031:3939320,3941657:4051247,4054442:4168678,4169607:4211953,4212333:4317940,4318843:4475646,4476902:4896927,4898358:4926865,4928109:5754581,5755746:6301865,6302894:6429335,6429723:6571222,6572833:6795065,6798259:7078954,7081291:7390993,7391914:7439518,7443980:7502295,7504632:7516673,7518284:7922551,7924154:8096815,8097851:8229129,8230634:8300001,8310000:8910407,8910723:9363411,9363565:9534137,9536594:9673405,9674824:10130420,10130918:10465707,10466310:10635653,10638047:10904482,10905728:11127899,11128324:11230562,11231807:11440953,11442559:11550823,11555439:11768304,11768732:12249487,12250742:12285357,12286966:12412961,12413963:12520749,12522360:12569501,12570125:12750811,12752422:13252060,13259651:13307612,13309171:13646471,13648097:14368988,14372535:14393455,14393880:14538798,14539959:14687825,14693449:14977755,14979012:15171971,15173218:15279421)
III<-c(1:119278,119466:358234,358380:393244,395662:484168,484323:503020,504278:527510,528626:700518,701037:863296,863448:934471,935719:941830,943059:1122893,1124136:1293379,1294625:1372600,1372697:1579373,1580222:2055540,2056711:2119192,2120803:2609655,2609752:3036510,3036598:3275617,3277786:3337860,3337985:3413549,3413688:3448565,3451099:3543889,3545147:3693072,3693500:3794699,3795046:3859330,3860576:4046849,4047355:4298087,4299333:4873810,4873962:5091049,5091604:5098171,5098767:5169104,5169299:5282437,5283492:5337208,5338048:5459465,5461071:5788220,5789812:5850356,5850805:6511268,6511781:6575790,6577036:6630160,6631713:6918380,6920150:6998125,6999787:7105364,7106611:7182407,7182530:7326293,7328824:7450001,7460000:7477244,7478496:7958672,7961317:8203936,8204778:8414634,8415729:8694363,8696699:8735294,8736553:9497546,9497688:9603976,9605479:9684337,9684804:9917178,9918393:10229930,10230382:10556259,10557516:10609632,10609753:10845671,10847470:11605280,11607617:11665561,11665682:11883827,11884949:11948083,11948180:12518405,12519651:12865165,12866776:12895294,12895445:13230086,13237296:13293133,13296541:13382284,13382590:13522042,13523650:13628593,13628744:13708289,13708403:13708727,13708914:13738595,13738993:13775399,13777022:13781343,13782223:13783801)
IV<-c(1:116813,117907:203060,203205:205363,205547:249600,249759:278556,278688:332901,333346:353477,353934:372669,372755:507688,513307:701904,707528:914138,919498:1137501,1139061:1161787,1162093:1270458,1272835:1511192,1512479:1646809,1646953:1770550,1771805:1884724,1885645:1981934,1984751:2368329,2371521:2485118,2486728:2589042,2591223:2902771,2909933:3078074,3078178:3281460,3281890:3313933,3316757:3461957,3462930:3498480,3501957:3948428,3952262:4097626,4097724:4180225,4184978:4220442,4221687:4304519,4305583:4500417,4502014:4504353,4504498:4546776,4546931:4559819,4562237:4715979,4720732:4768678,4771474:5003485,5003936:5056357,5056474:5610861,5612101:5793857,5794416:6006354,6008502:6141337,6142604:6162998,6163102:6343545,6347549:6793702,6793870:6865586,6866839:6947724,6950437:7012370,7012464:7053612,7053945:7145351,7147226:7197813,7197967:7524347,7525593:7625332,7626575:7803542,7804382:8097219,8098252:8400636,8403829:8434760,8435187:8580001,8590000:8734418,8734887:9041384,9041536:9172246,9172610:9246299,9246755:9331483,9332722:9347434,9348650:9405831,9406258:9412607,9413853:9502721,9503967:9548472,9556006:9620309,9621568:9685262,9686873:9750024,9751278:9808197,9809358:9851530,9851894:10549684,10551127:10884608,10885061:11080001,11090000:11189716,11191738:11192688,11193933:11195736,11196581:11238872,11240119:11273626,11274075:11408366,11409535:11418812,11420474:11681076,11681492:11834708,11835130:11869461,11870707:12109855,12110004:12315119,12316366:12460727,12462558:12509828,12512165:12875373,12876630:13049916,13051158:13113952,13114972:13122815,13124060:13223717,13225328:13293757,13296818:13458847,13460092:13546913,13547062:13608861,13609018:13629317,13629456:13670994,13671582:13802469,13803688:13815051,13817388:13849891,13850911:13915512,13916758:13947037,13948324:13966232,13967490:14012382,14013628:14116971,14117991:14186414,14189810:14245732,14246497:14251276,14253920:14256262,14257508:14510873,14511009:14545533,14546780:14839218,14840271:15233526,15233678:15331124,15331261:15342491,15344661:15420361,15420514:15484098,15485709:15498697,15499943:15583641,15583792:15869074,15869214:16007911,16009156:16158876,16162885:16203658,16203754:16239984,16243848:16262675,16267605:16310827,16310975:16313162,16318586:16575843,16577091:16638443,16639484:16734740,16735918:16750036,16750408:16770320,16771137:16788623,16788775:17006317,17008487:17145400,17146644:17169416,17170703:17177848,17179100:17218411,17219658:17238068,17238220:17389774,17392147:17438810,17439603:17493829)
V<-c(1:260529,263509:509943,510396:559071,559345:607913,608452:669431,670283:739436,741609:765782,771399:791347,796361:926213,927992:929676,930242:1035868,1037590:1834156,1835678:1836070,1837681:1899563,1900817:1915570,1916815:1954611,1955177:2172673,2173919:2239239,2241512:2325663,2326057:2346634,2347882:2454595,2455843:2562874,2564121:2632814,2634642:2818248,2818714:3048908,3050514:3161746,3162658:3251323,3252934:3325116,3330741:3332873,3333263:3478605,3479781:3590245,3591857:3795224,3796470:3914741,3915987:3924300,3926418:3989846,3991457:4063733,4066384:4202921,4203015:4304627,4308697:4312540,4313786:4603248,4604504:5146855,5149009:5186064,5190718:5209540,5209674:5459330,5459423:5474002,5477988:5548782,5550039:5667677,5668545:5762092,5762506:6235734,6236828:6417738,6422034:6554971,6555863:6628230,6629475:6945096,6945442:7056746,7057992:7309916,7310494:7310499,7311342:7535393,7536495:8327611,8330998:8475621,8485863:8487102,8488347:8837551,8844839:8852179,8852527:8879663,8886934:8894274,8894622:8966340,8967760:9277017,9278273:9493514,9496751:9650480,9651269:9760048,9761752:9770107,9771594:9890333,9891244:9938520,9940182:10078644,10079903:10187656,10189266:10284068,10285668:10308738,10309981:10494144,10494795:10751443,10752234:10773892,10775128:10985835,10987428:11153696,11155106:11288626,11290291:11319474,11320721:11324589,11326199:11518816,11519271:11590409,11591656:11606866,11607882:12020055,12020977:12381549,12384288:12800795,12802038:13124096,13126255:13135006,13135928:13967386,13967745:13998133,13998285:14007218,14008078:14029329,14030214:14040324,14043739:14066306,14067421:14072184,14073423:14077166,14078405:14201418,14204052:14622027,14623077:14752149,14754476:14903082,14906500:15022412,15023668:15157024,15157712:15300560,15301806:15489838,15491085:15592261,15592413:15616058,15617301:15737396,15738640:15842591,15843841:15851429,15854698:15907139,15908750:16169650,16169774:16295766,16297012:16312026,16313637:16380595,16381850:16631348,16632635:16690469,16692112:17095444,17097781:17111237,17111787:17130001,17141408:17142204,17143885:17180484,17180569:17184141,17184293:17195232,17196480:17230462,17234128:17332883,17333733:17423251,17428288:17496562,17497280:17514657,17519419:17576200,17580791:17630199,17637631:17641936,17643909:17644018,17645370:17645491,17648714:17805798,17807409:17816083,17816532:17893022,17893315:17902631,17903879:17915484,17916120:17949643,17949773:18004821,18004973:18119654,18121457:18151055,18152301:18316646,18316940:18427554,18429891:18442343,18443954:18447842,18455008:18530925,18532211:18742628,18743874:18764519,18766703:18874482,18874610:19270649,19277351:19413980,19415694:19443845,19443873:19456358,19456468:19729852,19730149:19851126,19853201:19962503,19964457:19966459,19968535:19969975,19972050:20020583,20020674:20078546,20079557:20152618,20153037:20153350,20153915:20257699,20259690:20290715,20293188:20410055,20410184:20458189,20458347:20510007,20513528:20616277,20617516:20721507,20721624:20724158,20724264:20924180)
X<-c(1:53227,54473:54764,54916:66250,70435:120001,130000:267029,268757:288210,289823:337977,338349:339291,340372:363088,364375:456749,456829:541635,542349:684518,684668:685633,685773:923110,923267:958495,958916:1031656,1033613:1227008,1228255:1242838,1242991:1340899,1343537:1351363,1354912:1562157,1565918:1659623,1662891:1760739,1761850:1762703,1774149:1789011,1790088:1927701,1928947:1946356,1947352:1954507,1955503:2005792,2008210:2009542,2010799:2168667,2169465:2170574,2171910:2310001,2310158:2412009,2412157:2490088,2490163:2607690,2607820:2763071,2763222:2777059,2777218:2810317,2810443:2934336,2934780:3003609,3003758:3128780,3130553:3139616,3139763:3296902,3297048:3307656,3308028:3370007,3371251:3514441,3515735:3735319,3736605:3746961,3753488:3845939,3848062:3871062,3871208:3909360,3909823:4415716,4415868:4428192,4429013:4445863,4447471:4862660,4863008:5222320,5223920:5232167,5233415:5284182,5285789:5650984,5651432:5757132,5758378:5779529,5779676:6067719,6069306:6467704,6468468:6486203,6486635:6660924,6661275:7017237,7018848:7068881,7069790:7079885,7080807:8166333,8168284:8314896,8314939:8343412,8343710:8640052,8640319:8766336,8767259:8817749,8818048:8826956,8827201:8876848,8876993:8901004,8901927:8999679,9001026:9196067,9203045:9249340,9250837:9470448,9471369:9521367,9521558:9541368,9541520:10189678,10189830:10217115,10217267:10715294,10715580:11290748,11294387:11311199,11312810:11313666,11314646:11350408,11350876:11792457,11802456:12312907,12314498:12371788,12372666:12581626,12581952:12996326,12996477:13059300,13059416:13077921,13078038:13087791,13088321:13295387,13296646:13450646,13451568:13489824,13490133:13629839,13629960:13682920,13684033:13698565,13699588:13761926,13762276:13807506,13808927:13831892,13833131:13982299,13982961:14061435,14062749:14091980,14094997:14366234,14366351:14400396,14400666:14456884,14458128:14530885,14532081:14748292,14748415:14874958,14875081:15062146,15063744:15348695,15349097:15366451,15366606:15397517,15400802:15509114,15509249:15625527,15625668:15720892,15721027:15746364,15746453:15746455,15746610:15782613,15783861:15825246,15826496:15831678,15831827:15848996,15849148:15988667,15988820:16037746,16037903:16050023,16050162:16070937,16071109:16109097,16112508:16218971,16219892:16231757,16236011:16318958,16319068:16452823,16455830:16618874,16619014:16945095,16945190:17014010,17015256:17031003,17032249:17060637,17061884:17125677,17127813:17169395,17170235:17183355,17183506:17196332,17197403:17238090,17238861:17250468,17252638:17257152,17270557:17299743,17300186:17387138,17388053:17619977,17622340:17639403,17639849:17644646,17649139:17665135,17665942:17689747,17692423:17703854,17707511:17718942)

lineNumber = (1:100) #second number is the number of simulations
print(lineNumber)
insertion_number <-(length(lineNumber))
print(insertion_number)
knownInsertion<- GRanges()
print(names(genome))

#create empty dataframe with the names of the 6 chromosomes
chr_names<- as.data.frame(setNames(replicate(6,numeric(0), simplify = F), c("I","II","III","IV","V","X")))
names(chr_names)


#i<-GRanges(IRanges(1,3477),seqnames="WBTransposon00000093", chrB="II", startB=2)
#knownInsertion<-append(knownInsertion,i)
#print(knownInsertion)
#sim = simulateSV(output=NA, genome=genome,regionsIns=knownInsertion, bpSeqSize=10, random=FALSE,verbose=FALSE,percCopiedIns=1)
#sim
#metadata(sim)


for (i in (1:insertion_number)){
  line = scan(RSVSIM_te_pos, what = "integer", skip=lineNumber[i]-1, nlines=1)
  trans_name<- line[4]
  chromosome <- line[1]
  print(chromosome)
  trans_start <- as.numeric(line[2])
  trans_end <- as.numeric(line[3])
  print(trans_start)
  print(trans_end)
  ins_position <-(names(chr_names))[sample(1:6,1)]
  print(ins_position)
  ins_position_eval<-eval(parse(text = ins_position))
  position <- sample((ins_position_eval),1)
  print(position)
  print(position)

  i<-GRanges(IRanges(trans_start,trans_end),seqnames=chromosome, chrB=ins_position, startB=position,percCopiedIns=1)
  knownInsertion<-append(knownInsertion,i)
}

sim = simulateSV(output=".", genome=genome,regionsIns=knownInsertion, bpSeqSize=10, random=FALSE,verbose=TRUE,percCopiedIns=1)
sim
metadata(sim)

